# Python program to read
# json file
 
import json
 
# Opening JSON file
vulnerabilityReport = open('dependency-check-report.json')

report = json.load(vulnerabilityReport)

# Repository table data

projectName = report['projectInfo']['name']
groupId = report['projectInfo']['groupID']
artifactId = report['projectInfo']['artifactID']

print("Repository table")
print(f"Project name: {projectName}")
print(f"groupId: {groupId}")
print(f"artifactId: {artifactId}")

print("Report table")
datetime = report['projectInfo']['reportDate']
reportSchema = report['reportSchema']
engineVersion = report['scanInfo']['engineVersion']
print(f"datetime: {datetime}")
print(f"reportSchema: {reportSchema}")
print(f"engineVersion: {engineVersion}")

count = 0
severityLevels = {'NONE': 0, 'LOW': 1, 'MEDIUM': 2, 'HIGH': 3, 'CRITICAL': 4}

print("Vulnerability table")
for dependency in report['dependencies']:
    dependencyName = dependency['fileName']

    vulnerabilityId = ""
    confidence = ""
    vulnerabilityUrl = ""
    packageUrl = ""

    if 'vulnerabilityIds' in dependency:
        for vulnerability in dependency['vulnerabilityIds']:
            vulnerabilityId += vulnerability['id'] + "; "
            confidence = vulnerability['confidence']
            if 'url' in vulnerability:
                vulnerabilityUrl = vulnerability['url'] + "; "

    package = ""
    if 'packages' in dependency:
        for pack in dependency['packages']:
            package += pack['id'] + "; "
            packageUrl = pack['url'] + "; "

    highestSeverity = 'NONE'
    cveCount = 0
    if 'vulnerabilities' in dependency:
        for vuln in dependency['vulnerabilities']:
            severity = vuln["severity"]
            if severityLevels.get(highestSeverity) < severityLevels.get(severity):
                highestSeverity = severity
            cveCount += len(vuln['cwes'])

    evidenceCount = 0
    if 'vendorEvidence' in dependency['evidenceCollected']:
        evidenceCount += len(dependency['evidenceCollected']['vendorEvidence'])

    if 'productEvidence' in dependency['evidenceCollected']:
        evidenceCount += len(dependency['evidenceCollected']['productEvidence'])

    if 'versionEvidence' in dependency['evidenceCollected']:
        evidenceCount += len(dependency['evidenceCollected']['versionEvidence'])

    if vulnerabilityId and highestSeverity != "NONE":
        print(f"dependency: {dependencyName}")
        print(f"vilnerabilityId: {vulnerabilityId}")
        print(f"package: {package}")
        print(f"confidence: {confidence}")
        print(f"highestSeverity: {highestSeverity}")
        print(f"cve count: {cveCount}")
        print(f"evidence count: {evidenceCount}")
        print(f"vulnerabilityUrl: {vulnerabilityUrl}")
        print(f"packageUrl: {packageUrl}")
        print('\n')
        count+=1


print(f"Length: {count}")
